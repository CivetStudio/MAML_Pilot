<?xml version="1.0" encoding="utf-8"?>
<Lockscreen frameRate="240" screenWidth="1080" version="1" vibrate="false" _dev="civet" _devTime="$_devTime" _splitExt="1" _splitGroup="1" _preload="1" _getSource="0" compiler="true">

	<Var name="CalendarX" expression="240" type="number" />
	<Var name="CalendarY" expression="540" type="number" />
	<Var name="CalendarW" expression="100" type="number" />
	<Var name="CalendarH" expression="100" type="number" />

	<!-- 闰年及月份数据 -->
	<Var name="LeapYear" expression="ifelse(eq(int(#year%4),0)*ne(int(#year%100),0)+eq(int(#year%400),0),1,0)" />
	<Var name="HasDateF29" expression="ifelse((eq(#LeapYear,1)+ne(#month,2))*eq(#HasDateF30,0)*eq(#HasDateF31,0),1,0)" />
	<Var name="HasDateF30" expression="ifelse(ne(#month,2)*eq(#HasDateF31,0),1,0)" />
	<Var name="HasDateF31" expression="ifelse(le(#month,1)+eq(#month,3)+eq(#month,5)+eq(#month,7)+eq(#month,8)+eq(#month,10)+eq(#month,12),1,0)" />
	<Var name="HasDate29" expression="ifelse(eq(#LeapYear,1)+ne(int(#month+1),2),1,0)" />
	<Var name="HasDate30" expression="ifelse(ne(int(#month+1),2),1,0)" />
	<Var name="HasDate31" expression="ifelse(eq(int(#month+1),1)+eq(int(#month+1),3)+eq(int(#month+1),5)+eq(int(#month+1),7)+eq(int(#month+1),8)+eq(int(#month+1),10)+eq(int(#month+1),12),1,0)" />

	<Var name="prevDayWeek_0" expression="int(#day_of_week-1)" type="number" />
	<Var name="nextDayWeek_0" expression="int(#day_of_week-1)" type="number" />

	<Var name="WeekDate_f0" expression="#date" type="number" />
	<Var name="WeekDate_0" expression="#date" type="number" />

	<!-- 后31天的星期与日期 -->
	<C_Array begin="1" end="31" indexName="_d" >

		<Var name="nextDayWeek_#_d" expression="int(#day_of_week-1+#_d+42)%7" />
		<Var name="WeekDate_#_d" expression="ifelse(eq(#WeekDate_{#_d-1},28),ifelse(#HasDate29,29,1),eq(#WeekDate_{#_d-1},29),ifelse(#HasDate30,30,1),eq(#WeekDate_{#_d-1},30),ifelse(#HasDate31,31,1),eq(#WeekDate_{#_d-1},31),1,#WeekDate_{#_d-1}+1)" />

	</C_Array>

	<!-- 前31天的星期与日期 -->
	<C_Array begin="1" end="31" indexName="_p" >

		<Var name="prevDayWeek_#_p" expression="int(#day_of_week-1-#_p+42)%7" />
		<Var name="WeekDate_f#_p" expression="ifelse(eq(#WeekDate_f{#_p-1},1),ifelse(eq((#month+1),3),28+#LeapYear,31*#HasDateF31+30*#HasDateF30+29*#HasDateF29),#WeekDate_f{#_p-1}-1)" />

	</C_Array>

	<!-- 起止点变量 -->
	<Var name="prevDayEnd" expression="max(#date-1,0)" type="number" />
	<Var name="nextDayEnd" expression="max(#monthMaxDay-#date,0)" type="number" />
	<!-- 每月最大天数 -->
	<Var name="monthMaxDay" expression="ifelse(eq(int(#month+1),1),31,eq(int(#month+1),2),28+#LeapYear,eq(int(#month+1),3),31,eq(int(#month+1),4),30,eq(int(#month+1),5),31,eq(int(#month+1),6),30,eq(int(#month+1),7),31,eq(int(#month+1),8),31,eq(int(#month+1),9),30,eq(int(#month+1),10),31,eq(int(#month+1),11),30,eq(int(#month+1),12),31,31)" />
	<!-- 每月的第一天 -->
	<Var name="weekStartsIn" expression="int((7-(#date-#day_of_week+1)%7)%7+1)%7" />

	<!-- 日期x居中 -->
	<Var name="calendarX" expression="#CalendarX" />
	<!-- 日期y居中 -->
	<Var name="calendarY" expression="#CalendarY" />
	<!-- 日期间距宽度 -->
	<Var name="calendarW" expression="#CalendarW" />
	<!-- 日期间距高度 -->
	<Var name="calendarH" expression="#CalendarH" />

	<!-- 日历 -->
	<C_Array count="42" indexName="_i" >

		<!-- 今年的第$天 -->
		<Var expression="ifelse(eq(#month,0),#WeekDate_f#_i+0,eq(#month,1),#WeekDate_f#_i+31,eq(#month,2),#WeekDate_f#_i+59,eq(#month,3),#WeekDate_f#_i+90,eq(#month,4),#WeekDate_f#_i+120,eq(#month,5),#WeekDate_f#_i+151,eq(#month,6),#WeekDate_f#_i+181,eq(#month,7),#WeekDate_f#_i+212,eq(#month,8),#WeekDate_f#_i+243,eq(#month,9),#WeekDate_f#_i+273,eq(#month,10),#WeekDate_f#_i+304,eq(#month,11),#WeekDate_f#_i+334,0)+#LeapYear*ge(#month,2)-1" name="da_prev_#_i" type="number" />

		<Var expression="ifelse(eq(#month,0),#WeekDate_#_i+0,eq(#month,1),#WeekDate_#_i+31,eq(#month,2),#WeekDate_#_i+59,eq(#month,3),#WeekDate_#_i+90,eq(#month,4),#WeekDate_#_i+120,eq(#month,5),#WeekDate_#_i+151,eq(#month,6),#WeekDate_#_i+181,eq(#month,7),#WeekDate_#_i+212,eq(#month,8),#WeekDate_#_i+243,eq(#month,9),#WeekDate_#_i+273,eq(#month,10),#WeekDate_#_i+304,eq(#month,11),#WeekDate_#_i+334,0)+#LeapYear*ge(#month,2)" name="da_next_#_i" type="number" />

		<!-- 今日及之前 -->
		<Text x="#calendarX+#calendarW*int((#weekStartsIn+#prevDayEnd-#_i)%7)" y="#calendarY+#calendarH*int((#weekStartsIn+#prevDayEnd-#_i)/7)" align="center" alignV="center" color="#FFFFFF" size="48" format="%d" paras="#WeekDate_f#_i" visibility="le(#_i,#prevDayEnd)" />
		<!-- <Text x="240+100*int((#weekStartsIn+#prevDayEnd-#_i)%7)" y="480+200*int((#weekStartsIn+#prevDayEnd-#_i)/7)+48" align="center" alignV="top" color="#FFFFFF" size="30" textExp="'周'+substr('日一二三四五六',#prevDayWeek_#_i,1)" visibility="le(#_i,#prevDayEnd)" alpha="180" /> -->

		<Text x="#calendarX+#calendarW*int((#weekStartsIn+1+#prevDayEnd+#_i)%7)" y="#calendarY+#calendarH*int((#weekStartsIn+1+#prevDayEnd+#_i)/7)" align="center" alignV="center" color="#FFFFFF" size="48" format="%d" paras="#WeekDate_{#_i+1}" visibility="le(#WeekDate_{#_i+1},#monthMaxDay)*lt(#_i,#nextDayEnd)" />
		<!-- <Text x="240+100*int((#weekStartsIn+1+#prevDayEnd+#_i)%7)" y="480+200*int((#weekStartsIn+1+#prevDayEnd+#_i)/7)+48" align="center" alignV="top" color="#FFFFFF" size="30" textExp="'周'+substr('日一二三四五六',#nextDayWeek_{#_i+1},1)" visibility="le(#WeekDate_{#_i+1},#monthMaxDay)*lt(#_i,#nextDayEnd)" alpha="180" /> -->

	</C_Array>

	<!-- 经测试，C_Array 可投入代码库 -->

</Lockscreen>