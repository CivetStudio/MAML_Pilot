<Template>

	<!-- @_traffic_value[#slot] -->
	<!-- @_traffic_unit[#slot] -->

	<ExternalCommands>
		<Trigger action="init,resume">
			<BinderCommand name="networkassistant" command="refresh" />
		</Trigger>
	</ExternalCommands>

	<VariableBinders>
		<ContentProviderBinder name="networkassistant" uri="content://com.miui.networkassistant.provider/datausage_status_detailed" column="package_type,total_limit,month_used,today_used,bill_value,traffic_time,traffic_value,traffic_unit" countName="has">
			<!-- 套餐类型： -2:无卡状态 -1：未设置 0：月套餐卡 1：日套餐卡 2：无限套餐卡，-2状态指的是卡1+卡2都没有 -->
			<Variable name="_package_type" type="string[]" column="package_type" />
			<!-- 总套餐量 ,  流量单位byte -->
			<Variable name="_total_limit" type="string[]" column="total_limit" />
			<!-- 本月使用量 ,  流量单位是byte -->
			<Variable name="_month_used" type="string[]" column="month_used" />
			<!-- 今日使用量 ,  流量单位是byte -->
			<Variable name="_today_used" type="string[]" column="today_used" />
			<!-- 剩余话费 -->
			<Variable name="_bill_value" type="string[]" column="bill_value" />
			<!-- 剩余流量 -->
			<Variable name="_traffic_value" type="string[]" column="traffic_value" />
			<!-- 剩余流量单位 -->
			<Variable name="_traffic_unit" type="string[]" column="traffic_unit" />

			<!-- 上次矫正时间戳（long） ， 默认为0 -->
			<Variable name="_traffic_time" type="string[]" column="traffic_time" />
			<Trigger>
				<FunctionCommand target="fra" />
				<LoopCommand count="2" indexName="i">
					<!-- 套餐总量 -->
					<VariableCommand name="_total_limit_str" expression="ifelse(@_total_limit[#i] }= 1024*1024*1024 , preciseeval('@_total_limit[#i]/1024/1024/1024',2) , preciseeval('@_total_limit[#i]/1024/1024',2))" type="string[]" index="#i" />
					<!-- 套餐总量单位 -->
					<VariableCommand name="_total_limit_unit_str" expression="ifelse(@_total_limit[#i] }= 1024*1024*1024 , 'GB' , 'MB')" type="string[]" index="#i" />

					<!-- 本月已使用 -->
					<VariableCommand name="_month_used_str" expression="ifelse(@_month_used[#i] }= 1024*1024*1024 , preciseeval('@_month_used[#i]/1024/1024/1024',2) , preciseeval('@_month_used[#i]/1024/1024',2))" type="string[]" index="#i" />
					<!-- 本月已使用单位-->
					<VariableCommand name="_month_used_unit_str" expression="ifelse(@_month_used[#i] }= 1024*1024*1024 , 'GB' , 'MB')" type="string[]" index="#i" />

					<!-- 本月已剩余 -->
					<VariableCommand name="_month_left" expression="preciseeval('@_total_limit[#i]-@_month_used[#i]',2)" type="string[]" index="#i" />
					<VariableCommand name="_month_left_str" expression="ifelse(@_month_left[#i] }= 1024*1024*1024 , preciseeval('@_month_left[#i]/1024/1024/1024',2) , preciseeval('@_month_left[#i]/1024/1024',2))" type="string[]" index="#i" />
					<!-- 本月已剩余单位-->
					<VariableCommand name="_month_left_unit_str" expression="ifelse(@_month_left[#i] }= 1024*1024*1024 , 'GB' , 'MB')" type="string[]" index="#i" />

					<!-- 今日使用量 -->
					<VariableCommand name="_today_used_str" expression="ifelse(@_today_used[#i] }= 1024*1024*1024 , preciseeval('@_today_used[#i]/1024/1024/1024',2) , preciseeval('@_today_used[#i]/1024/1024',2))" type="string[]" index="#i" />
					<!-- 今日使用量单位 -->
					<VariableCommand name="_today_used_unit_str" expression="ifelse(@_today_used[#i] }= 1024*1024*1024 , 'GB' , 'MB')" type="string[]" index="#i" />


					<!-- 套餐类型 -->
					<VariableCommand name="_package_type_str" expression="ifelse(strIsEmpty(@_package_type[#i]),'无卡',@status[@_package_type[#i]+2])" type="string[]" index="#i" />
					<!-- 剩余话费 -->
					<VariableCommand name="_bill_value_str" expression="preciseeval('@_bill_value[#i]',2)" type="string[]" index="#i" />
					<!-- 更新时间 -->
					<VariableCommand name="_traffic_time_str" expression="ifelse(strIsEmpty(@_traffic_time[#i]), '无数据' ,eqs(@_traffic_time[#i],'0'), '未更新' , formatDate('yy/M/d HH:mm 更新',@_traffic_time[#i]))" type="string[]" index="#i" />
				</LoopCommand>
			</Trigger>
		</ContentProviderBinder>
	</VariableBinders>

	<!-- 套餐数组 -->
	<Var name="status" type="string[]" const="true" expression="''" values="'无卡状态' , '未设置' , '月套餐卡' , '日套餐卡' , '无限套餐卡'" />

	<!-- 数组范围 -->
	<Var name="_total_limit_str" expression="" type="string[]" size="2" />
	<Var name="_total_limit_unit_str" expression="" type="string[]" size="2" />
	<Var name="_month_used_str" expression="" type="string[]" size="2" />
	<Var name="_month_used_unit_str" expression="" type="string[]" size="2" />
	<Var name="_month_left" expression="" type="string[]" size="2" />
	<Var name="_month_left_str" expression="" type="string[]" size="2" />
	<Var name="_month_left_unit_str" expression="" type="string[]" size="2" />
	<Var name="_today_used_str" expression="" type="string[]" size="2" />
	<Var name="_today_used_unit_str" expression="" type="string[]" size="2" />
	<Var name="_package_type_str" expression="" type="string[]" size="2" />
	<Var name="_bill_value_str" expression="" type="string[]" size="2" />
	<Var name="_traffic_time_str" expression="" type="string[]" size="2" />

	<!-- 数据数组 分别为 套餐类型，总流量，月使用量，今日使用量，剩余话费，更新日期 -->
	<Var name="sim0_data" type="string[]" expression="''" values="@_package_type_str[0] , @_total_limit_str[0]+@_total_limit_unit_str[0] , @_month_used_str[0]+@_month_used_unit_str[0] , @_today_used_str[0]+@_today_used_unit_str[0] , @_bill_value_str[0] , @_traffic_time_str[0]" />
	<Var name="sim1_data" type="string[]" expression="''" values="@_package_type_str[1] , @_total_limit_str[1]+@_total_limit_unit_str[1] , @_month_used_str[1]+@_month_used_unit_str[1] , @_today_used_str[1]+@_today_used_unit_str[1] , @_bill_value_str[1] , @_traffic_time_str[1]" />

</Template>